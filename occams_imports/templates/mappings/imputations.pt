<html metal:use-macro="load: ../master.pt">
  <metal:content-slot fill-slot="content-slot">
    <div style="display: none;" data-bind="visible: isReady">
    <header class="page-header">
      <h1 i18n:translate="">Imputation Mapping</h1>
    </header>
    <p i18n:translate="" class="lead">
        This interface was designed so you can map variables using imputations.
    </p>
    <div data-bind="css: { 'alert': true, 'alert-danger': isDanger, 'alert-info': isInfo,
                   'alert-success': isSuccess }">
      <strong data-bind="text: msgType"></strong>
      <span data-bind="text: msg"></span>
    </div>

    <div class="row">
      <div class="col-md-6">
        <div class="panel panel-primary">
          <div class="panel-heading">Select and/or convert</div>
          <div class="panel-body">
            <form class="form-horizontal"
                  role="form"
                  data-bind="foreach: conversions">
              <div data-bind="if: ($index() > 0 && !$root.conversions()[$index() -1].newConversion())">
                <div class="row">
                  <div class="col-sm-offset-3 col-sm-3">
                    <select data-bind="options: $data.mathOperators,
                                       value: $data.selectedOperator"
                            class="form-control"
                            id="math_operators"
                            name="math_operators"></select>
                  </div>
                  <div class="col-sm-3">

                    <select data-bind="options: $data.operatorChoices,
                                       value: $data.selectedOperatorChoice"
                            class="form-control"
                            id="direct_forms"
                            name="direct_forms"></select>
                  </div>
                  <div data-bind="if: $data.selectedOperatorChoice() == 'By value'">
                  <div class="col-sm-3">
                    <input class="form-control"
                           data-bind="value: value"
                           type="number"></input>
                    </div>
                    </div>

                </div> <!-- end row -->
                <br />
              </div>
              <div class="form-group">
                <label class="control-label col-sm-3"
                       for="direct_forms">Form:</label>
                <div class="col-sm-6">
                  <select data-bind="options: $root.forms,
                                     optionsText: 'name',
                                     value: $data.selectedForm,
                                     optionsCaption: 'Select a form...'"
                          class="form-control"
                          id="direct_forms"
                          name="direct_forms"></select>
                  </div> <!-- end col 6-->
                  <div class="col-sm-3">
                  <div data-bind="ifnot: $data.selectedForm">
                    <input type="text"
                           readonly="readonly"
                           class="form-control"
                           placeholder="Publish date"></input>
                  </div>
                  <div data-bind="with: $data.selectedForm">
                    <input data-bind="value: $data.publish_date"
                           readonly="readonly"
                           type="text"
                           id="direct_version"
                           name="direct_version"
                           class="form-control"></input>
                  </div> <!-- end with selected form -->
                  </div>

                  <!--dynamic value input was here -->


                </div> <!-- end form group-->

              <div class="form-group">
                <label class="control-label col-sm-3"
                       for="direct_variables">Variable:</label>
                  <div data-bind="ifnot: $data.selectedForm">
                    <div class="col-sm-6">
                     <input type="text"
                           readonly="readonly"
                           class="form-control"
                           placeholder="Variable to be mapped"></input>
                    </div> <!-- end col 6-->
                  </div> <!-- if not selected form -->
                <div data-bind="with: $data.selectedForm">
                  <div class="col-sm-6">
                    <select data-bind="options: $data.attributes,
                                       optionsText: 'variable',
                                       value: $parent.selectedAttribute"
                            class="form-control"
                            id="direct_variables"
                            name="direct_variables"></select>
                 </div> <!-- end col 6-->
                </div> <!-- end with selected form -->
                </div> <!-- end form group -->
<!-- start new conversion used to be here -->
                <div data-bind="if: newConversion()">
                  <hr >
                </div>
            </form> <!-- end foreach conversions -->

            <div class="row">
              <div class="col-md-2 col-md-offset-9">
                <button type="button"
                        class="btn btn-default dropdown-toggle"
                        data-toggle="dropdown">
                  options
                  <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                  <li><a data-bind="click: addConversion">Add Operation</a></li>
                  <li><a data-bind="click: deleteConversion">Remove Operation</a></li>
                  <li><a>Add new bucket</a></li>
                </ul>
              </div> <!-- btn-group-->
            </div> <!-- end row-->
            </div> <!-- panel body-->
          </div> <!-- panel primary -->
        </div> <!-- end col 6 -->

      <div class="col-md-6">
        <div class="panel panel-primary">
          <div class="panel-heading">Imputation</div>
          <div class="panel-body">

        <form class="form-horizontal" role="form">
          <div class="form-group">
            <label class="control-label col-sm-3"
                   for="direct_forms">Form:</label>
            <div class="col-sm-6">
              <select data-bind="options: drsc_forms,
                                 optionsText: 'name',
                                 value: selectedDRSCForm,
                                 optionsCaption: 'Select a form...'"
                      class="form-control"
                      id="direct_forms"
                      name="direct_forms"></select>
            </div> <!-- end col 6 -->
            <div id="loading"
                 style="display: none;"
                 data-bind="visible: isLoading">
              <div class="col-sm-1">
                <div class="throbber-loader">
                </div>
              </div>
            </div>
          </div> <!-- end form group -->

          <div class="form-group">
            <label class="control-label col-sm-3"
                   for="direct_version">Version:</label>
            <div class="col-sm-6">
              <div data-bind="ifnot: selectedDRSCForm">
                <input type="text"
                       readonly="readonly"
                       class="form-control"
                       placeholder="Publish date of the form"></input>
              </div>
              <div data-bind="with: selectedDRSCForm">
                <input data-bind="value: publish_date"
                       readonly="readonly"
                       type="text"
                       id="direct_version"
                       name="direct_version"
                       class="form-control"></input>
              </div> <!-- end selected drsc form -->
            </div> <!-- end col 6 -->
          </div> <!-- end form group -->

          <div class="form-group">
            <label class="control-label col-sm-3"
                   for="direct_variables">Variable:</label>
              <div data-bind="ifnot: selectedDRSCForm">
                <div class="col-sm-6">
                 <input type="text"
                       readonly="readonly"
                       class="form-control"
                       placeholder="Variable to be mapped"></input>
                </div> <!-- end col 6 -->
              </div> <!-- end selected drsc form -->
              <div data-bind="with: selectedDRSCForm">
                <div class="col-sm-6">
                    <select data-bind="options: attributes,
                                       optionsText: 'variable',
                                       value: $root.selectedDRSCAttribute"
                            class="form-control"
                            id="direct_variables"
                            name="direct_variables"></select>
                 </div> <!-- end col 6 -->
              </div> <!-- end selected drsc form-->
          </div> <!-- end form group -->

          <!-- If choice, give user ability to select map to -->
          <div data-bind="with: selectedDRSCAttribute">
            <div data-bind="if: choices().length != 0">


              <div class="form-group">
                <label class="control-label col-sm-3"
                       for="direct_version">Map to:</label>
                <div class="col-sm-6">
                  <select data-bind="options: choices,
                                 optionsText: 'label',
                                 value: $root.selectedMapTo"
                          class="form-control"></select>
                  </div>
                </div>
              </div>
            <!-- If no choice, display variable name for users info -->
            <div data-bind="if: choices().length == 0">
              <div class="form-group">
                <label class="control-label col-sm-3"
                       for="direct_version">Maps to:</label>
                <div class="col-sm-6">
                  <input type="text"
                         readonly="readonly"
                         class="form-control"
                         data-bind="value: variable"></input>
                  </div>
                </div>
              </div>
            </div>
        </form>
        <hr>
            <div class="row">
              <div class="col-md-2">
                <select data-bind="options: conditions,
                                   value: selectedComparisonCondition"
                        class="form-control"
                        id="operator"
                        name="operator"></select>
              </div>
              <div class="col-md-4">
                <button type="button"
                        class="btn btn-default dropdown-toggle"
                        data-toggle="dropdown">
                  Comparison Operator
                <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                  <li><a href="#"
                         data-bind="click: addComparisonOperator">Add</a></li>
                  <li><a href="#"
                         data-bind="click: deleteComparisonOperator">Remove</a></li>
                </ul>
              </div> <!-- end col 4 -->

              <div class="col-md-4">
                <button type="button"
                        class="btn btn-default dropdown-toggle"
                        data-toggle="dropdown">
                  Logical Operator
                <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                  <li><a href="#"
                         data-bind="click: addLogicalOperator">Add</a></li>
                  <li><a href="#"
                         data-bind="click: deleteLogicalOperator">Remove</a></li>
                </ul>
              </div> <!-- end col 4 -->
            </div> <!-- end row -->

            <div data-bind="foreach: comparisonOperators">
              <div class="row">
                <br />
                <div class="col-md-2">
                  <select data-bind="options: operators,
                                     value: selectedOperator"
                          class="form-control"
                          id="comparison_operator"
                          name="comparison_operator"></select>

                </div>
                <div class="col-md-3">
                  <input type="text"
                         class="form-control"
                         data-bind="value: value">
                  </input>
                </div>
              </div> <!-- end row -->
            </div> <!-- end foreach comparisonOperators -->

            <div data-bind="foreach: logicalOperators">
              <div class="row">
                <br />
                <div class="col-md-2">
                  <select data-bind="options: operators,
                                     value: selectedOperator"
                          class="form-control"
                          id="logical_operator"
                          name="logical_operator"></select>
                </div> <!-- end col 2 -->

                <div class="col-md-4">
                  <button type="button"
                          class="btn btn-default dropdown-toggle"
                          data-toggle="dropdown">
                    Comparison Operator
                  <span class="caret"></span>
                  </button>
                  <ul class="dropdown-menu">
                    <li><a href="#"
                           data-bind="click: addComparisonOperator">Add</a></li>
                    <li><a href="#"
                           data-bind="click: deleteComparisonOperator">Remove</a></li>
                  </ul>
                </div> <!-- end col 4 -->
              </div> <!-- end row -->

                <div data-bind="foreach: comparisons">
                  <div class="row">
                    <br />
                    <div class="col-md-2 col-md-offset-2">
                      <select data-bind="options: operators,
                                         value: selectedOperator"
                              class="form-control"
                              id="comparison_operator"
                              name="comparison_operator"></select>

                    </div>
                    <div class="col-md-3">
                      <input type="text"
                             class="form-control"
                             data-bind="value: value">
                      </input>
                    </div> <!-- end col 2 -->
                  </div> <!-- end row -->
                </div> <!-- end foreach comparisons -->
            </div> <!-- end foreach logicalOperators -->

          <br />
          <br />

          <div class="row">
            <label class="control-label col-sm-2"
                   for="confidence">Confidence:</label>
            <div class="col-sm-2">
                <input type="number"
                       class="form-control"
                       id="confidence"
                       min="1"
                       max="3"
                       data-bind="value: confidence"></input>
            </div>
            <div class="col-md-5">
            <!-- ko if: $root.confidence() == "1" -->
            <h6>No/little manipulation/interpretation</h6>
            <!-- /ko -->

            <!-- ko if: $root.confidence() == "2" -->
            <h6>Some manipulation/interpretation</h6>
            <!-- /ko -->

            <!-- ko if: $root.confidence() == "3" -->
            <h6>Significant manipulation/interpretation</h6>
            <!-- /ko -->
            </div>
            <div class="col-md-2">
              <button class="btn btn-primary btn-lg"
                      type="button"
                      data-bind="click: saveImputation">Map</button>
            </div>
          </div> <!--end row -->
          </div> <!-- end panel body -->
        </div> <!-- end panel primary -->
      </div> <!--end col 6 -->
    </div> <!-- end row -->
    </div> <!-- end is ready -->
  </metal:content-slot>

  <metal:javascript-slot fill-slot="javascript-extras-slot">
    <script type="text/javascript">
      $(function(){
        'use strict';
        ko.applyBindings(new imputationViewModel());
      });
    </script>
  </metal:javascript-slot>

</html>